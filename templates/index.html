<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.1, maximum-scale=0.1, user-scalable=no">
  <title>Kanban Pizza</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Kanban Pizza is an interactive online game to learn Agile and Kanban principles through pizza-making simulation. Join a room, build pizzas, and optimize your workflow!">
  <meta name="keywords" content="Kanban, Agile, pizza game, workflow simulation, team collaboration, online game, learning tool">
  <meta name="author" content="Adam Clement 2025">
  <meta name="robots" content="index, follow">

  <!-- Open Graph Meta Tags (for social media sharing) -->
  <meta property="og:title" content="Kanban Pizza - Agile Workflow Game">
  <meta property="og:description" content="Master Agile and Kanban by making virtual pizzas! Join a room, collaborate, and streamline your process in this fun simulation.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://kanbanpizza.onrender.com/">
  <meta property="og:image" content="https://kanbanpizza.onrender.com/static/pizzaman.jpg">
  <meta property="og:site_name" content="Kanban Pizza">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Kanban Pizza - Agile Workflow Game">
  <meta name="twitter:description" content="Learn Kanban and Agile through a fun pizza-making game. Play now!">
  <meta name="twitter:image" content="https://kanbanpizza.onrender.com/static/pizzaman.jpg">

  <!-- Favicon and Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="static/favicon-16x16.png">
  <link rel="manifest" href="static/site.webmanifest">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Sigmar&display=swap" rel="stylesheet">
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "qk0k83579x");
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YN4X6ZF91C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-YN4X6ZF91C');
  </script>
<style>
  .instImg {
    position: relative;
    left: 0; /* Adjusted for mobile */
    max-width: 90%; /* Ensure images fit on small screens */
    margin-left: auto;
    display: block;
  }

  body {
    position: relative;
    background: #f8f9fa;
    color: #333;
    min-height: 100vh;
    background-color: #DFDBE5;
    background: url('static/tile10.svg') repeat center center;
    background-size: 128px 128px; /* Smaller tiles for mobile */
    font-family: "Roboto Condensed", serif;
    font-optical-sizing: auto;
  }
  .minheight {
    min-height: 12vh !important;
  }
  h1 {
    font-size: clamp(2rem, 8vw, 4rem); /* Responsive font size */
  }
  h1, h2, h3, h4, h5 {
    font-family: "Sigmar", serif;
    font-weight: 400;
    font-style: normal;
  }
  .modal-dialog {
    max-width: 95%; /* Adjusted for mobile */
    margin: 1rem auto;
  }
  .modal-content {
    position: relative;
    background: #ffffff;
    color: #333;
  }
  .modal-content::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('static/pizzaman.jpg') no-repeat center center;
    background-size: cover;
    opacity: 0.45;
    z-index: -1;
  }
  .modal-body {
    background: rgba(255, 255, 255, 0.95);
    max-height: 70vh; /* Prevent overflow on mobile */
    overflow-y: auto;
  }
  .game-container {
    background-color: rgba(255,255,255,0.9);
    padding: 15px; /* Reduced padding for mobile */
    border-radius: 8px;
    margin: 10px; /* Adjusted margin */
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  header {
    border-bottom: 2px solid #dee2e6;
    margin-bottom: 15px;
  }
  .ingredient {
    font-size: clamp(1.5rem, 5vw, 2rem); /* Responsive emoji size */
    margin: 5px;
    padding: 5px;
    cursor: pointer;
    touch-action: manipulation; /* Improve touch response */
  }
  .ingredient.selected {
    border: 2px solid #007bff;
    border-radius: 4px;
  }
  .timer-container {
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', sans-serif;
    text-align: center;
  }
  .timer-container.oven {
    width: clamp(120px, 25vw, 200px); /* Responsive width */
    height: clamp(60px, 15vw, 100px);
    border: 6px solid #444;
    border-radius: 10px;
    background: linear-gradient(145deg, #777, #333);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
    font-size: clamp(0.8rem, 2vw, 1rem);
    color: #fff;
    margin-right: 2vw;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.3s, box-shadow 0.3s;
  }
  .timer-container.oven.oven-active {
    background: linear-gradient(145deg, #ff6666, #cc0000);
    box-shadow: 0 0 10px #ff6666;
  }
  .timer-container.stopwatch {
    width: clamp(100px, 20vw, 150px);
    height: clamp(100px, 20vw, 150px);
    border: 8px solid #222;
    border-radius: 50%;
    background: radial-gradient(circle, #fff 60%, #e0e0e0);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    font-size: clamp(0.8rem, 2vw, 1rem);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .btn-custom {
    margin: 5px;
    padding: 10px 15px; /* Larger touch target */
    font-size: clamp(0.9rem, 2.5vw, 1rem);
  }
  .emoji-wrapper {
    position: relative;
    display: inline-block;
    width: 2.5rem;
    height: 2.5rem;
    font-size: 2rem;
  }
  .emoji-wrapper .emoji {
    position: absolute;
    top: 0;
    left: 0;
  }
  .emoji-wrapper .emoji:not(:first-of-type) {
    transform: scale(0.6);
    left: -0.2rem;
  }
  .undercooked .emoji {
    filter: sepia(1) hue-rotate(10deg) saturate(300%);
  }
  #built-pizzas .emoji, #oven .emoji {
    filter: sepia(1) hue-rotate(10deg) saturate(300%);
  }
  .burnt .emoji {
    filter: grayscale(1) brightness(0.3);
  }
  .invalid .emoji, .unmatched .emoji {
    filter: grayscale(1) contrast(1.2);
  }
  #messages {
    background-color: #000;
    border: 2px solid #555;
    border-radius: 5px;
    padding: 5px 10px;
    color: #0f0;
    font-family: 'Courier New', monospace;
    margin-top: 10px;
    min-height: 40px;
    font-size: clamp(0.8rem, 2vw, 1rem);
  }
  #messages .title {
    font-size: 0.8rem;
    margin-bottom: 3px;
    text-transform: uppercase;
    color: #0f0;
  }
  .pizza-builder-container {
    border: 1px solid #4A4A4A;
    padding: 10px;
    margin-bottom: 10px;
    min-height: 120px;
  }
  .pizza-builder-dropzone {
    background-color: #D3D3D3;
    min-height: 80px;
    border: 1px dashed #4A4A4A;
    padding: 10px;
  }
  .order-card {
    background-color: #e9ecef;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 8px;
    margin: 5px;
    width: clamp(140px, 30vw, 180px);
    height: clamp(100px, 25vw, 120px);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    font-size: clamp(0.8rem, 2vw, 0.9rem);
    text-align: center;
  }
  .order-id {
    font-weight: bold;
    margin-bottom: 5px;
  }
  .order-ingredients {
    margin: 5px 0;
    font-size: 1rem;
  }
  .order-emoji {
    font-size: clamp(1.2rem, 4vw, 1.5rem);
  }
  #orders-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .gridcontainer {
    display: grid;
    grid-template-columns: 1.4fr 0.2fr 1.4fr;
    grid-template-rows: 0.6fr 1.8fr 0.1fr 1.4fr 0.1fr 1.7fr;
    gap: 0px 0px;
    grid-auto-flow: row;
    grid-template-areas:
      "buttons . ovenbuttons"
      "ingredients . builders"
      ". . ."
      "built . oven"
      ". . ."
      "completed . wasted";
  }
  .buttons { grid-area: buttons; }
  .ovenbuttons { grid-area: ovenbuttons; }
  .ingredients { grid-area: ingredients; }
  .builders { grid-area: builders; }
  .oven { grid-area: oven; }
  .built { grid-area: built; }
  .completed { grid-area: completed; }
  .wasted { grid-area: wasted; }
  #room-name-label, #player-count-label {
    display: inline;
    font-size: 1rem;
    color: #555;
    margin-top: 5px;
  }
  /* New ribbon styles */
  .fork-me-on-github {
    position: fixed;
    top: 0;
    right: 0;
    border: 0;
    z-index: 9999;
  }
  .fork-me-on-github svg {
    fill: #e1d800;
    color: #CE0000; /*  Octocat */
    width: 80px;
    height: 80px;
  }
  .fork-me-on-github:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
  @keyframes octocat-wave {
    0%, 100% {
      transform: rotate(0);
    }
    20%, 60% {
      transform: rotate(-25deg);
    }
    40%, 80% {
      transform: rotate(10deg);
    }
  }
  @media (max-width: 500px) {
    .fork-me-on-github:hover .octo-arm {
      animation: none; /* No animation on hover */
    }
    .fork-me-on-github .octo-arm {
      animation: octocat-wave 560ms ease-in-out; /* Continuous animation */
    }
  }
  @media (max-width: 800px) {
    .fork-me-on-github {
      float:right;
    }
    .fork-me-on-github svg {
      width: 60px;
      height: 60px;
    }
  }

  @media screen and (max-width: 768px) {
    .gridcontainer {
      grid-template-columns: 1fr; /* Single column on mobile */
      grid-template-rows: auto; /* Auto height for rows */
      grid-template-areas:
        "buttons"
        "ovenbuttons"
        "ingredients"
        "builders"
        "built"
        "oven"
        "completed"
        "wasted";
    }
    .game-container {
      padding: 10px;
      margin: 5px;
    }
    .timer-container.oven {
      margin-right: 0;
      margin-bottom: 10px;
    }
    .btn-custom {
      width: 100%; /* Full-width buttons on mobile */
      margin: 5px 0;
    }
    .modal-dialog {
      max-width: 100%;
      margin: 0;
    }
    .pizzaman {
      padding: 5vw;
      background-size: contain; /* Adjust image for mobile */
    }
    #room-input {
      max-width: 100%; /* Full width on mobile */
    }
  }
  .is-invalid {
    border-color: #dc3545 !important;
  }
  .invalid-feedback {
    display: block;
    color: #dc3545;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }
  .pizzaman {
    background: #e1d800;
    padding: 2vw;
    background: url('static/pizzaman2.png') no-repeat center center;
    background-size: cover;
    max-width: 40%;
  }
</style>
</head>
<body>
<div class="container game-container">
    <header class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3">🍕 Kanban Pizza</h1>
        <div>
          <h5>Room Name: <span id="room-name-label"></span></h5>
          <h5>Player Count: <span id="player-count-label"></span></h5>
           <button id="instructions-btn" class="btn btn-info btn-custom">Instructions</button>
        </div>
      </div>
        <div class="d-flex align-items-center">
          <div id="oven-container" class="timer-container oven me-3">
            <span id="oven-timer" class="oven-timer">Oven Time:</span>
          </div>
          <div class="timer-container stopwatch">
            <span id="timer" class="timer">Round Time:</span>
          </div>
        </div>
    </header>

    <nav class="d-flex flex-column mb-3">
      <div class="d-flex justify-content-between align-items-center w-100">
        <div>
          <button id="start-round" class="btn btn-warning btn-custom">Start Round</button>
         </div>
      </div>
      <div id="messages">
        <div class="title">ROOM MESSAGES:</div>
        <div class="content"></div>
      </div>
    </nav>

    <main>
      <div id="customer-orders" class="mb-3" style="display: none;">
        <h4>Customer Orders (<span id="order-count">0</span>)</h4>
        <div id="orders-list" class="d-flex flex-wrap border p-2" style="min-height: 50px; border: solid #4A4A4A!important; overflow-y: auto; max-height: 200px;"></div>
      </div>
      <div id="game-area" class="mb-3" style="display: none;">
        <div class="gridcontainer">
          <div class="buttons">
            <h3>Prepare Ingredients</h3>
            <div id="prepare-buttons" class="mb-3">
              <button onclick="prepareIngredient('base')" class="btn btn-outline-primary btn-custom">Base</button>
              <button onclick="prepareIngredient('sauce')" class="btn btn-outline-primary btn-custom">Sauce</button>
              <button onclick="prepareIngredient('ham')" class="btn btn-outline-primary btn-custom">Ham</button>
              <button onclick="prepareIngredient('pineapple')" class="btn btn-outline-primary btn-custom">Pineapple</button>
            </div>
          </div>
          <div class="ovenbuttons">
            <button id="oven-on" class="btn btn-success btn-custom">Turn Oven On</button>
            <button id="oven-off" class="btn btn-danger btn-custom">Turn Oven Off</button>
          </div>
          <div class="ingredients">
            <h4>Shared Ingredients</h4>
            <div id="prepared-pool" class="d-flex flex-wrap border p-2 mb-3" style="min-height: 100px;border: solid #4A4A4A!important;"></div>
          </div>
          <div class="builders">
            <h3 id="builder-heading">Your Pizza Builder</h3>
            <div id="pizza-builder"
                 ondrop="dropToBuilder(event)"
                 ondragover="allowDrop(event)"
                 class="flex-wrap border p-2 mb-3"
                 style="min-height: 100px;border: solid #4A4A4A!important; display: flex;"></div>
            <button id="submit-pizza" class="btn btn-primary btn-custom" style="display: none;">Submit Pizza</button>
            <div id="pizza-builders-container" class="row" style="display: none;"></div>
          </div>
          <div class="oven">
            <h5>Oven</h5>
            <div id="oven" class="minheight d-flex flex-wrap border p-2 mb-3" style="min-height: 5vh; border: solid #4A4A4A!important;"></div>
          </div>
          <div class="built">
            <h5>Built Pizzas</h5>
            <div id="built-pizzas" class="minheight d-flex flex-wrap border p-2 mb-3" style="min-height: 5vh; border: solid #4A4A4A!important;"></div>
          </div>
          <div class="completed">
            <h5>Completed Pizzas</h5>
            <div id="completed" class="minheight d-flex flex-wrap border p-2 mb-3" style="min-height: 5vh; border: solid #4A4A4A!important;"></div>
          </div>
          <div class="wasted">
            <h5>Wasted Pizzas</h5>
            <div id="wasted" class="minheight d-flex flex-wrap border p-2 mb-3" style="min-height: 5vh; border: solid #4A4A4A!important;"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div class="modal" tabindex="-1" id="roomModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <!-- Replaced #forkongithub with new ribbon -->
        <a target="_blank"  href="https://github.com/adamclement-exe/kanbanpizza" class="fork-me-on-github" aria-label="Fork me on GitHub">
          <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" />
            <path
              d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm"
            />
            <path
              d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body"
            />
          </svg>
        </a>
        <div class="modal-header">
          <div class="col-md-6" style="margin-right:2vw;">
            <h1 class="modal-title">🍕 Welcome to <br/>Kanban Pizza!</h1>
            <button id="instructions-btn0" class="btn btn-info btn-custom">Instructions</button>
          </div>
          <div class="col-md-6 pizzaman" >
            <form id="join-form">
              <div class="mb-3">
                <h3>Join / Create a Room</h3>
                <label for="room-input" class="form-label">Enter Room Name</label>
                <input type="text" class="form-control" id="room-input" placeholder="Room name" required style="max-width:15vw;">
                <div id="room-input-feedback" class="invalid-feedback"></div>
              </div>
              <button type="submit" class="btn btn-primary">Enter Room</button>
            </form>
          </div>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-12">
              <p><strong>Room Limits:</strong> Maximum 10 active rooms at a time. Each room can have up to 5 players.</p>
              <h3>Active Rooms</h3>
              <table class="table table-striped" id="room-table">
                <thead>
                  <tr>
                    <th>Room Name</th>
                    <th>Players</th>
                  </tr>
                </thead>
                <tbody id="room-table-body">
                  <!-- Dynamically populated via JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" tabindex="-1" id="modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">How to Play 🍕 Kanban Pizza</h5>
          <button type="button" class="btn-close" id="modal-close" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><strong>Objective:</strong> Build and bake pizzas to score points.</p>
          <p><strong>How to Play Round 1:</strong></p>
          <p>Click the Start Round button to begin.  The round timer will start counting down from 3 minutes, and the game area will be displayed.</p>
          <img class="instImg" src="/static/1.gif"/>
          <p></p>
          <p>Press on the ingredients buttons to create fresh ingredients! They will appear in the Shared Ingredients box.  The ingredients in this box can be used by everyone in the room.</p>
          <img class="instImg" src="/static/2.gif"/>
          <p></p>
          <p>Drag and Drop, (on mobile tap to select, then tap to drop), your ingredients to the Pizza Builder to create a pizza.</p>
          <img class="instImg" src="/static/3.gif"/>
          <br/>
          <img class="instImg" src="/static/4.gif"/>
          <p>Valid pizzas in round 1 are:</p>
          <ul>
            <li>Ham Pizza - 1 Base, 1 Sauce, 4 Ham</li>
            <li>Ham & Pineapple Pizza - 1 Base, 1 Sauce, 2 Ham, 2 Pineapple</li>
          </ul>
          <p>When you have all the ingredients in the Pizza Builder, press the Submit Pizza button to send the pizza to the Built Pizzas area.</p>
          <img class="instImg" src="static/5.gif" />
          <p>The Built Pizza area holds all the room's pizzas - there is no limit to how many pizzas you can store here!</p>
          <p>Each pizza has a button which will move it to the oven.  The oven has a WiP (Work in Progress) limit of 3, meaning you can only cook 3 pizzas at a time. To cook the pizzas just switch on the oven.  Pizzas need to spend between 30 and 45 seconds in a switched on oven to be properly cooked.</p>
          <img class="instImg" src="static/6.gif" />
          <p>Once the oven is switched on, you can not add more pizza without first switching off the oven.  When the oven is switched off all pizzas inside it are removed - if they have been cooked for 30-45 seconds they will be added to the Completed Pizzas box.</p>
          <p>Pizzas cooked for less than 30 seconds, or more than 45 seconds and pizzas prepared with incorrect ingredients will be moved to the Wasted Pizzas box.</p>

          <table border="1" style="border-collapse: collapse; width: 100%;">
            <caption><strong>Round 1 Scoring</strong></caption>
            <thead>
              <tr style="background-color: #f2f2f2;">
                <th>Component</th>
                <th>Points</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Completed Pizzas</td>
                <td>+10</td>
                <td>Per pizza baked for 30-45 seconds</td>
              </tr>
              <tr>
                <td>Wasted Pizzas</td>
                <td>-10</td>
                <td>Per undercooked (< 30s), burnt (> 45s), or invalid pizza</td>
              </tr>
              <tr>
                <td>Uncooked Pizzas</td>
                <td>-5</td>
                <td>Per pizza built but not baked or still in oven at end</td>
              </tr>
              <tr>
                <td>Leftover Ingredients</td>
                <td>-1</td>
                <td>Per unused prepared ingredient</td>
              </tr>
            </tbody>
          </table>
          <p><strong>How to Play Round 2:</strong></p>
          <ul>
            <li>Drag or tap ingredients from the Shared Ingredients pool to any of the Shared Pizza Builders.</li>
            <li>Any player can add ingredients to any shared builder and submit pizzas from them.</li>
            <li>Collaboration is key—work together to optimize pizza production!</li>
          </ul>

          <table border="1" style="border-collapse: collapse; width: 100%;">
            <caption><strong>Round 2 Scoring</strong></caption>
            <thead>
              <tr style="background-color: #f2f2f2;">
                <th>Component</th>
                <th>Points</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Completed Pizzas</td>
                <td>+10</td>
                <td>Per pizza baked for 30-45 seconds</td>
              </tr>
              <tr>
                <td>Wasted Pizzas</td>
                <td>-10</td>
                <td>Per undercooked (< 30s), burnt (> 45s), or invalid pizza</td>
              </tr>
              <tr>
                <td>Uncooked Pizzas</td>
                <td>-5</td>
                <td>Per pizza built but not baked or still in oven at end</td>
              </tr>
              <tr>
                <td>Leftover Ingredients</td>
                <td>-1</td>
                <td>Per unused prepared ingredient</td>
              </tr>
            </tbody>
          </table>
          <p><strong>How to Play Round 3:</strong></p>
          <ul>
            <li>Use the Shared Pizza Builders to collaborate, as in Round 2.</li>
            <li>50 customer orders arrive throughout the round, specifying exact ingredient combinations:</li>
            <ul>
              <li><strong>Ham:</strong> 1 base, 1 sauce, 4 ham</li>
              <li><strong>Pineapple:</strong> 1 base, 1 sauce, 4 pineapple</li>
              <li><strong>Ham & Pineapple:</strong> 1 base, 1 sauce, 2 ham, 2 pineapple</li>
              <li><strong>Light Ham:</strong> 1 base, 1 sauce, 1 ham</li>
              <li><strong>Light Pineapple:</strong> 1 base, 1 sauce, 1 pineapple</li>
              <li><strong>Plain:</strong> 1 base, 1 sauce</li>
              <li><strong>Heavy Ham:</strong> 1 base, 1 sauce, 6 ham</li>
              <li><strong>Heavy Pineapple:</strong> 1 base, 1 sauce, 6 pineapple</li>
            </ul>
            <li>Build pizzas to match these orders exactly. Unmatched pizzas are wasted.</li>
            <li>Orders arrive over time, with the last one at least 45 seconds before the round ends.</li>
          </ul>

          <table border="1" style="border-collapse: collapse; width: 100%;">
            <caption><strong>Round 3 Scoring</strong></caption>
            <thead>
              <tr style="background-color: #f2f2f2;">
                <th>Component</th>
                <th>Points</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Fulfilled Orders</td>
                <td>+20</td>
                <td>Per cooked pizza matching a customer order</td>
              </tr>
              <tr>
                <td>Unmatched Pizzas</td>
                <td>-10</td>
                <td>Per cooked pizza not matching any order</td>
              </tr>
              <tr>
                <td>Wasted Pizzas</td>
                <td>-10</td>
                <td>Per undercooked (< 30s), burnt (> 45s), or unmatched build</td>
              </tr>
              <tr>
                <td>Uncooked Pizzas</td>
                <td>-5</td>
                <td>Per pizza built but not baked or still in oven at end</td>
              </tr>
              <tr>
                <td>Leftover Ingredients</td>
                <td>-1</td>
                <td>Per unused prepared ingredient</td>
              </tr>
              <tr>
                <td>Remaining Orders</td>
                <td>-15</td>
                <td>Per unfulfilled customer order at end</td>
              </tr>
            </tbody>
          </table>
          <hr>
          <p><em>"Individuals and interactions over processes and tools" – as stated in the Agile Manifesto. Collaborate, adapt, and continuously improve your pizza-making process!</em></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="debriefModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title">End of Round Summary</h5>
        </div>
        <div class="modal-body" id="debriefModalBody">
          <p><strong>Pizzas Completed:</strong> <span id="debrief-pizzas-completed">0</span></p>
          <p><strong>Pizzas Wasted:</strong> <span id="debrief-pizzas-wasted">0</span></p>
          <p><strong>Uncooked Pizzas:</strong> <span id="debrief-pizzas-unsold">0</span></p>
          <p><strong>Leftover Ingredients:</strong> <span id="debrief-ingredients-left">0</span></p>
          <p id="fulfilled-orders" style="display: none;"><strong>Fulfilled Orders:</strong> <span id="debrief-fulfilled-orders">0</span></p>
          <p id="remaining-orders" style="display: none;"><strong>Remaining Orders:</strong> <span id="debrief-remaining-orders">0</span></p>
          <p id="unmatched-pizzas" style="display: none;"><strong>Unmatched Pizzas:</strong> <span id="debrief-unmatched-pizzas">0</span></p>
          <p><strong>Score:</strong> <span id="debrief-score">0</span></p>
          <hr>
          <p><em class="text-muted" id="debrief-question"></em></p>
          <p><em class="text-muted" id="debrief-quote"></em></p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    var socket = io({ transports: ['websocket', 'polling'], reconnection: true });
    var myRoom = localStorage.getItem('myRoom') || "";
    var isInitialConnect = true;

    // Swear filter using Purgomalum API
    async function checkProfanity(text) {
      try {
        const response = await fetch(`https://www.purgomalum.com/service/containsprofanity?text=${encodeURIComponent(text)}`);
        const containsProfanity = await response.text();
        return containsProfanity === 'true';
      } catch (error) {
        console.error('Profanity check failed:', error);
        return false; // Fallback: Assume no profanity if API fails
      }
    }

    async function filterRoomName(event) {
      event.preventDefault();
      const roomInput = document.getElementById("room-input");
      const feedback = document.getElementById("room-input-feedback");
      const roomName = roomInput.value.trim();

      if (!roomName) {
        roomInput.classList.add("is-invalid");
        feedback.textContent = "Room name cannot be empty.";
        return;
      }

      const hasProfanity = await checkProfanity(roomName);
      if (hasProfanity) {
        roomInput.classList.add("is-invalid");
        feedback.textContent = "Room name contains inappropriate language. Please choose another.";
        return;
      }

      roomInput.classList.remove("is-invalid");
      feedback.textContent = "";
      myRoom = roomName;
      localStorage.setItem('myRoom', myRoom);
      socket.emit('join', { room: myRoom });
    }

    socket.on('connect', function() {
      if (isInitialConnect) {
        var roomModal = new bootstrap.Modal(document.getElementById('roomModal'), {
          backdrop: 'static',
          keyboard: false
        });
        roomModal.show();
        socket.emit('request_room_list');
        isInitialConnect = false;
      } else if (myRoom) {
        socket.emit('join', { room: myRoom });
        console.log("Reconnecting to room:", myRoom);
      }
    });

    socket.on('disconnect', function() {
      console.log("Disconnected from server");
      updateMessage("Disconnected. Attempting to reconnect...");
    });

    socket.on('reconnect', function() {
      console.log("Reconnected to server");
      updateMessage("Reconnected to room " + myRoom);
    });

    document.getElementById("join-form").addEventListener("submit", filterRoomName);

    var builderIngredients = [];
    var touchSelectedIngredient = null;
    var ingredientEmoji = {
      "base": "🟡",
      "sauce": "🔴",
      "ham": "🥓",
      "pineapple": "🍍"
    };
    var orderEmoji = {
      "ham": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🥓</span></div>',
      "pineapple": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🍍</span></div>',
      "ham & pineapple": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🥓</span><span class="emoji">🍍</span></div>',
      "light ham": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🥓</span></div>',
      "light pineapple": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🍍</span></div>',
      "plain": '<div class="emoji-wrapper"><span class="emoji">🍕</span></div>',
      "heavy ham": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🥓</span></div>',
      "heavy pineapple": '<div class="emoji-wrapper"><span class="emoji">🍕</span><span class="emoji">🍍</span></div>'
    };

    const debriefContent = {
      1: {
        question: "Reflect on the round: How did you identify and streamline your pizza-making process? Did the oven’s WIP limit of 3 pizzas affect your strategy?",
        quote: "“Working software is the primary measure of progress.” – Agile Manifesto. In this case, think of 'working software' as successfully baked pizzas!"
      },
      2: {
        question: "Reflect on the round: How did collaboration with your team impact your pizza production? Did sharing builders help or hinder your flow?",
        quote: "“Individuals and interactions over processes and tools.” – Agile Manifesto. Collaboration is key to adapting and improving!"
      },
      3: {
        question: "Reflect on the round: How did customer orders change your priorities? Were you able to balance order fulfillment with minimizing waste?",
        quote: "“Customer collaboration over contract negotiation.” – Agile Manifesto. Meeting customer needs drives success!"
      }
    };

    function updateMessage(text) {
      document.querySelector("#messages .content").innerText = text;
    }

    function updateRoomLabels(room, playerCount) {
      document.getElementById("room-name-label").innerText = `${room}`;
      document.getElementById("player-count-label").innerText = `${playerCount}`;
    }

    setInterval(() => {
      socket.emit('time_request');
    }, 1000);

    socket.on('room_list', function(data) {
      var tbody = document.getElementById('room-table-body');
      tbody.innerHTML = '';
      Object.keys(data.rooms).forEach(function(room) {
        var row = document.createElement('tr');
        var nameCell = document.createElement('td');
        nameCell.innerText = room;
        var countCell = document.createElement('td');
        countCell.innerText = data.rooms[room];
        row.appendChild(nameCell);
        row.appendChild(countCell);
        tbody.appendChild(row);
      });
    });

    socket.on('join_error', function(data) {
      const feedback = document.getElementById("room-input-feedback");
      document.getElementById("room-input").classList.add("is-invalid");
      feedback.textContent = data.message;
    });

    socket.on('game_state', function(newState) {
      updateGameState(newState);
      var joinModal = bootstrap.Modal.getInstance(document.getElementById('roomModal'));
      if (joinModal) {
        joinModal.hide();
      }
    });

    var modalEl = document.getElementById("modal");
    var modal = new bootstrap.Modal(modalEl);
    document.getElementById("instructions-btn").addEventListener("click", () => modal.show());
    document.getElementById("instructions-btn0").addEventListener("click", () => modal.show());
    document.getElementById("modal-close").addEventListener("click", () => modal.hide());

    socket.on('time_response', function(data) {
      if (data.phase === "debrief") {
        document.getElementById("timer").innerText = "DEBRIEF:\n" + data.roundTimeRemaining + " sec";
      } else if (data.phase === "round") {
        document.getElementById("timer").innerText = "Round Time:\n" + data.roundTimeRemaining + " sec";
      } else {
        document.getElementById("timer").innerText = "Round Time:";
      }
      document.getElementById("oven-timer").innerText = "Oven Time:\n" + data.ovenTime + " sec";
    });

    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) {
      ev.dataTransfer.setData("ingredient_id", ev.target.getAttribute("data-id"));
      ev.dataTransfer.setData("ingredient_type", ev.target.dataset.type);
    }
    function dropToBuilder(ev) {
      ev.preventDefault();
      var ingredient_id = ev.dataTransfer.getData("ingredient_id");
      var ingredient_type = ev.dataTransfer.getData("ingredient_type");
      socket.emit('take_ingredient', { ingredient_id: ingredient_id });
      if (state.round === 1) {
        builderIngredients.push({ id: ingredient_id, type: ingredient_type });
        updateBuilderDisplay();
      }
    }
    function dropToSharedBuilder(ev, sid) {
      ev.preventDefault();
      var ingredient_id = ev.dataTransfer.getData("ingredient_id");
      var ingredient_type = ev.dataTransfer.getData("ingredient_type");
      socket.emit('take_ingredient', { ingredient_id: ingredient_id, target_sid: sid });
    }
    function updateBuilderDisplay() {
      var builderDiv = document.getElementById("pizza-builder");
      builderDiv.innerHTML = "";
      builderIngredients.forEach(function(ing) {
        var item = document.createElement("div");
        item.classList.add("ingredient");
        item.innerText = ingredientEmoji[ing.type] || ing.type;
        builderDiv.appendChild(item);
      });
    }
    function prepareIngredient(type) {
      socket.emit('prepare_ingredient', { ingredient_type: type });
    }

    function renderPizzaBuilders(players) {
      var container = document.getElementById("pizza-builders-container");
      container.innerHTML = "";
      Object.keys(players).forEach(function(sid, index) {
        var colDiv = document.createElement("div");
        colDiv.classList.add("col-md-4");
        var builderDiv = document.createElement("div");
        builderDiv.classList.add("pizza-builder-container");
        builderDiv.innerHTML = `<h5>Builder #${index + 1}</h5>`;
        var ingredientsDiv = document.createElement("div");
        ingredientsDiv.classList.add("d-flex", "flex-wrap", "pizza-builder-dropzone");
        ingredientsDiv.setAttribute("ondrop", `dropToSharedBuilder(event, '${sid}')`);
        ingredientsDiv.setAttribute("ondragover", "allowDrop(event)");
        players[sid]["builder_ingredients"].forEach(function(ing) {
          var item = document.createElement("div");
          item.classList.add("ingredient");
          item.innerText = ingredientEmoji[ing.type] || ing.type;
          ingredientsDiv.appendChild(item);
        });
        builderDiv.appendChild(ingredientsDiv);
        var submitBtn = document.createElement("button");
        submitBtn.className = "btn btn-primary btn-custom mt-2";
        submitBtn.innerText = "Submit Pizza";
        submitBtn.onclick = function() {
          socket.emit('build_pizza', { player_sid: sid });
        };
        builderDiv.appendChild(submitBtn);
        colDiv.appendChild(builderDiv);
        container.appendChild(colDiv);

        if ('ontouchstart' in window) {
          ingredientsDiv.addEventListener("touchend", function(ev) {
            ev.preventDefault();
            if (touchSelectedIngredient) {
              socket.emit('take_ingredient', { ingredient_id: touchSelectedIngredient.id, target_sid: sid });
              touchSelectedIngredient = null;
              var selectedItems = document.querySelectorAll('.ingredient.selected');
              selectedItems.forEach(function(el) {
                el.classList.remove('selected');
              });
            }
          });
        }
      });
    }

    document.getElementById("submit-pizza").addEventListener("click", function() {
      if (builderIngredients.length === 0) {
        alert("No ingredients selected for pizza!");
        return;
      }
      socket.emit('build_pizza', { ingredients: builderIngredients });
      builderIngredients = [];
      updateBuilderDisplay();
    });

    if ('ontouchstart' in window) {
      var builderDiv = document.getElementById("pizza-builder");
      builderDiv.addEventListener("touchend", function(ev) {
        ev.preventDefault();
        if (touchSelectedIngredient && state.round === 1) {
          socket.emit('take_ingredient', { ingredient_id: touchSelectedIngredient.id });
          builderIngredients.push({ id: touchSelectedIngredient.id, type: touchSelectedIngredient.type });
          updateBuilderDisplay();
          var selectedItems = document.querySelectorAll('.ingredient.selected');
          selectedItems.forEach(function(el) {
            el.classList.remove('selected');
          });
          touchSelectedIngredient = null;
        }
      });
    }

    var state = {};
    function updateGameState(newState) {
      state = newState;
      console.log("Game State:", state);

      const playerCount = Object.keys(state.players).length;
      updateRoomLabels(myRoom || "Unknown", playerCount);

      if (state.current_phase === "round") {
        document.getElementById("game-area").style.display = "block";
        document.getElementById("start-round").style.display = "none";
      } else {
        document.getElementById("game-area").style.display = "none";
        document.getElementById("start-round").style.display = "inline-block";
      }

      updateVisibility();

      var ordersDiv = document.getElementById("customer-orders");
      var ordersList = document.getElementById("orders-list");
      var orderCount = document.getElementById("order-count");
      if (state.round === 3 && state.current_phase === "round") {
        ordersDiv.style.display = "block";
        ordersList.innerHTML = "";
        state.customer_orders.forEach(function(order) {
          var card = document.createElement("div");
          card.classList.add("order-card");
          card.setAttribute("data-order-id", order.id);

          var idDiv = document.createElement("div");
          idDiv.classList.add("order-id");
          idDiv.innerText = `Order: ${order.id.slice(0, 6)}`;
          card.appendChild(idDiv);

          var ingredientsDiv = document.createElement("div");
          ingredientsDiv.classList.add("order-ingredients");
          var ingredientsText = [];
          if (order.ingredients.base > 0) ingredientsText.push(`${ingredientEmoji["base"]}x${order.ingredients.base}`);
          if (order.ingredients.sauce > 0) ingredientsText.push(`${ingredientEmoji["sauce"]}x${order.ingredients.sauce}`);
          if (order.ingredients.ham > 0) ingredientsText.push(`${ingredientEmoji["ham"]}x${order.ingredients.ham}`);
          if (order.ingredients.pineapple > 0) ingredientsText.push(`${ingredientEmoji["pineapple"]}x${order.ingredients.pineapple}`);
          ingredientsDiv.innerText = ingredientsText.join(" ");
          card.appendChild(ingredientsDiv);

          var emojiDiv = document.createElement("div");
          emojiDiv.classList.add("order-emoji");
          emojiDiv.innerHTML = orderEmoji[order.type] || '<div class="emoji-wrapper"><span class="emoji">🍕</span></div>';
          card.appendChild(emojiDiv);

          ordersList.appendChild(card);
        });
        orderCount.innerText = state.customer_orders.length;
      } else {
        ordersDiv.style.display = "none";
        orderCount.innerText = "0";
      }

      var poolDiv = document.getElementById("prepared-pool");
      poolDiv.innerHTML = "";
      state.prepared_ingredients.forEach(function(item) {
        var div = document.createElement("div");
        div.classList.add("ingredient");
        div.setAttribute("draggable", "true");
        div.setAttribute("data-id", item.id);
        div.dataset.type = item.type;
        div.innerText = ingredientEmoji[item.type] || item.type;
        div.addEventListener("dragstart", drag);
        if ('ontouchstart' in window) {
          div.addEventListener("touchstart", function(ev) {
            ev.preventDefault();
            var previouslySelected = document.querySelectorAll('.ingredient.selected');
            previouslySelected.forEach(function(el) {
              el.classList.remove('selected');
            });
            touchSelectedIngredient = { id: item.id, type: item.type };
            div.classList.add("selected");
          });
        }
        poolDiv.appendChild(div);
      });

      function renderPizza(pizza, extraLabel) {
        var div = document.createElement("div");
        if (pizza.emoji) {
          div.innerHTML = pizza.emoji;
        } else {
          div.innerText = "Pizza " + pizza.pizza_id;
        }
        if (extraLabel) {
          var label = document.createElement("span");
          label.innerText = extraLabel;
          div.appendChild(label);
        }
        if (pizza.status) {
          div.classList.add(pizza.status);
        }
        return div;
      }

      var builtDiv = document.getElementById("built-pizzas");
      builtDiv.innerHTML = "";
      state.built_pizzas.forEach(function(pizza) {
        var div = renderPizza(pizza, "");
        var btn = document.createElement("button");
        btn.className = "btn btn-sm btn-outline-primary ms-2";
        btn.innerText = "Move to Oven";
        btn.onclick = function() {
          socket.emit('move_to_oven', { pizza_id: pizza.pizza_id });
        };
        div.appendChild(btn);
        builtDiv.appendChild(div);
      });

      var ovenDiv = document.getElementById("oven");
      ovenDiv.innerHTML = "";
      state.oven.forEach(function(pizza) {
        var div = renderPizza(pizza, " ");
        ovenDiv.appendChild(div);
      });

      var compDiv = document.getElementById("completed");
      compDiv.innerHTML = "";
      state.completed_pizzas.forEach(function(pizza) {
        var div = renderPizza(pizza, " ");
        compDiv.appendChild(div);
      });

      var wastedDiv = document.getElementById("wasted");
      wastedDiv.innerHTML = "";
      state.wasted_pizzas.forEach(function(pizza) {
        var div = renderPizza(pizza, "");
        wastedDiv.appendChild(div);
      });
    }

    function updateVisibility() {
      const pizzaBuilder = document.getElementById("pizza-builder");
      const submitPizza = document.getElementById("submit-pizza");
      const buildersContainer = document.getElementById("pizza-builders-container");
      const builderHeading = document.getElementById("builder-heading");

      if (state.round >= 1 && state.current_phase === "debrief" && state.round < state.max_rounds) {
        console.log("Debrief after Round 1 or 2: Showing shared builders");
        pizzaBuilder.style.display = "none";
        submitPizza.style.display = "none";
        buildersContainer.style.display = "flex";
        builderHeading.innerText = "Shared Pizza Builders";
        renderPizzaBuilders(state.players);
      } else if (state.round > 1) {
        console.log("Round 2+: Showing shared builders");
        pizzaBuilder.style.display = "none";
        submitPizza.style.display = "none";
        buildersContainer.style.display = "flex";
        builderHeading.innerText = "Shared Pizza Builders";
        if (state.current_phase === "round") {
          renderPizzaBuilders(state.players);
        }
      } else {
        console.log("Round 1 or waiting: Showing pizza-builder");
        pizzaBuilder.style.display = "flex";
        submitPizza.style.display = "inline-block";
        buildersContainer.style.display = "none";
        builderHeading.innerText = "Your Pizza Builder";
      }
    }

    socket.on('round_started', function(data) {
      state.round = data.round;
      state.current_phase = "round";
      state.customer_orders = data.customer_orders;
      updateMessage("Round " + data.round + " started. Duration: " + data.duration + " sec");
      document.getElementById("game-area").style.display = "block";
      document.getElementById("start-round").style.display = "none";
      var debriefModalEl = document.getElementById('debriefModal');
      var debriefModal = bootstrap.Modal.getInstance(debriefModalEl);
      if (debriefModal) {
        debriefModal.hide();
      }
      updateGameState(state);
    });

    socket.on('round_ended', function(result) {
      document.getElementById("debrief-pizzas-completed").innerText = result.completed_pizzas_count;
      document.getElementById("debrief-pizzas-wasted").innerText = result.wasted_pizzas_count;
      document.getElementById("debrief-pizzas-unsold").innerText = result.unsold_pizzas_count;
      document.getElementById("debrief-ingredients-left").innerText = result.ingredients_left_count || 0;
      document.getElementById("debrief-score").innerText = result.score;
      if (state.round === 3) {
        document.getElementById("fulfilled-orders").style.display = "block";
        document.getElementById("remaining-orders").style.display = "block";
        document.getElementById("unmatched-pizzas").style.display = "block";
        document.getElementById("debrief-fulfilled-orders").innerText = result.fulfilled_orders_count || 0;
        document.getElementById("debrief-remaining-orders").innerText = result.remaining_orders_count || 0;
        document.getElementById("debrief-unmatched-pizzas").innerText = result.unmatched_pizzas_count || 0;
      } else {
        document.getElementById("fulfilled-orders").style.display = "none";
        document.getElementById("remaining-orders").style.display = "none";
        document.getElementById("unmatched-pizzas").style.display = "none";
      }

      const content = debriefContent[state.round] || {
        question: "Reflect on the round.",
        quote: "“Continuous improvement is better than delayed perfection.” – Agile principle."
      };
      document.getElementById("debrief-question").innerText = content.question;
      document.getElementById("debrief-quote").innerText = content.quote;

      var debriefModal = new bootstrap.Modal(document.getElementById('debriefModal'), {});
      debriefModal.show();
      updateVisibility();
    });

    socket.on('game_reset', function(state) {
      updateMessage("Round reset. Ready for a new round.");
      document.getElementById("timer").innerText = "Round Time:";
      document.getElementById("start-round").style.display = "inline-block";
      var debriefModalEl = document.getElementById('debriefModal');
      var modalInstance = bootstrap.Modal.getInstance(debriefModalEl);
      if (modalInstance) {
        modalInstance.hide();
      }
      updateGameState(state);
    });

    socket.on('ingredient_prepared', function(item) {
      updateMessage("Ingredient prepared: " + (ingredientEmoji[item.type] || item.type));
    });
    socket.on('build_error', function(data) {
      updateMessage("Build Error: " + data.message);
    });
    socket.on('pizza_built', function(pizza) {
      updateMessage("Pizza built: " + pizza.pizza_id);
    });
    socket.on('oven_error', function(data) {
      updateMessage("Oven Error: " + data.message);
    });
    socket.on('pizza_moved_to_oven', function(pizza) {
      updateMessage("Pizza moved to oven: " + pizza.pizza_id);
    });
    socket.on('oven_toggled', function(data) {
      updateMessage((data.state === "on") ? "Oven turned ON." : "Oven turned OFF.");
      var ovenContainer = document.getElementById("oven-container");
      if (data.state === "on") {
        ovenContainer.classList.add("oven-active");
      } else {
        ovenContainer.classList.remove("oven-active");
      }
    });
    socket.on('clear_shared_builder', function(data) {
      renderPizzaBuilders(state.players);
    });
    socket.on('new_order', function(order) {
      updateMessage("New order received: " + order.type);
      state.customer_orders.push(order);
      var ordersList = document.getElementById("orders-list");
      var card = document.createElement("div");
      card.classList.add("order-card");
      card.setAttribute("data-order-id", order.id);

      var idDiv = document.createElement("div");
      idDiv.classList.add("order-id");
      idDiv.innerText = `Order: ${order.id.slice(0, 6)}`;
      card.appendChild(idDiv);

      var ingredientsDiv = document.createElement("div");
      ingredientsDiv.classList.add("order-ingredients");
      var ingredientsText = [];
      if (order.ingredients.base > 0) ingredientsText.push(`${ingredientEmoji["base"]}x${order.ingredients.base}`);
      if (order.ingredients.sauce > 0) ingredientsText.push(`${ingredientEmoji["sauce"]}x${order.ingredients.sauce}`);
      if (order.ingredients.ham > 0) ingredientsText.push(`${ingredientEmoji["ham"]}x${order.ingredients.ham}`);
      if (order.ingredients.pineapple > 0) ingredientsText.push(`${ingredientEmoji["pineapple"]}x${order.ingredients.pineapple}`);
      ingredientsDiv.innerText = ingredientsText.join(" ");
      card.appendChild(ingredientsDiv);

      var emojiDiv = document.createElement("div");
      emojiDiv.classList.add("order-emoji");
      emojiDiv.innerHTML = orderEmoji[order.type] || '<div class="emoji-wrapper"><span class="emoji">🍕</span></div>';
      card.appendChild(emojiDiv);

      ordersList.appendChild(card);
      document.getElementById("order-count").innerText = state.customer_orders.length;
    });
    socket.on('order_fulfilled', function(data) {
      updateMessage("Order fulfilled: " + data.order_id);
      var orderElement = document.querySelector(`[data-order-id="${data.order_id}"]`);
      if (orderElement) {
        orderElement.remove();
        document.getElementById("order-count").innerText = state.customer_orders.length;
      }
    });

    document.getElementById("oven-on").addEventListener("click", function() {
      socket.emit('toggle_oven', { state: "on" });
    });
    document.getElementById("oven-off").addEventListener("click", function() {
      socket.emit('toggle_oven', { state: "off" });
    });
    document.getElementById("start-round").addEventListener("click", function() {
      socket.emit('start_round', {});
    });
    window.addEventListener("beforeunload", function () {
      socket.disconnect();
    });

    socket.on('game_state_update', function(update) {
      if (update.customer_orders) state.customer_orders = update.customer_orders;
      if (update.pending_orders) state.pending_orders = update.pending_orders;
      updateGameState(state);
    });

    socket.on('room_expired', function(data) {
      updateMessage(data.message);
      var roomModal = new bootstrap.Modal(document.getElementById('roomModal'), {
        backdrop: 'static',
        keyboard: false
      });
      roomModal.show();
      socket.emit('request_room_list');
    });
  </script>

  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'91c10bf55880b05e',t:'MTc0MTI1NTY1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
